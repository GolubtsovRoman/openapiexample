# Пример использования OpenApiGenerate 

Цель: продемострировать автогенерацию API на основе схемы (данном случае `.yaml`) спроетированной заранее на https://editor.swagger.io/

## Приложение

Элементарное CRUD приложение, которе отдает все данные из единственной таблице. Намеренно написано избыточно и имеет стандартные слоти, такие как: сервис, репозиторий, контроллер, модель и пр.

### Стэк: 
За основу взяты максимальные версии библиотек, которые были на момент написания приложения.

- kotlin 2.0.0
- JDK 21
- Spring Boot 3.3.1
- H2 database 2.2.224 (взята дял простоты)
- плагин org.openapi.generator 7.6.0

### Принцип работы

Предварительно созданную в https://editor.swagger.io/ схему кладем в наш проект. В моём случае она лежит в `resources/open-api/openapiexample.yaml`.

Далее в gradle нужно добавить:

1. Плагин
```kotlin
plugins {
    id("org.openapi.generator") version "7.6.0"
}
```

2. Блок с настройками
```kotlin
openApiGenerate {
    // настройки
}
```

3. Блок, котокрый подключает сгенерированный код к нашим исходникам (вольная трактовка)
```kotlin
sourceSets {
    getByName("main") {
        kotlin {
            srcDir("<папка, куда сгенерировали код>")
        }
    }
}
```

4. Нужно чтобы код сгенерировался перед компиляцией, поэтому явнол говорим об этом gradle
```kotlin
tasks.compileKotlin {
    dependsOn(tasks.openApiGenerate)
}
```

### Настройка генерации
См. файл `build.gradle.kts`

Предварительно нужно посмотреть документацию на сайте https://openapi-generator.tech/docs/generators

1. Сначала мы явно указываем какой генератор используем. В нашем случае это `kotlin-spring`
```kotlin
generatorName.set("kotlin-spring")
```
(Примечаение) С именами есть некоторая путаница: большикство генераторов сервера API имеет суффикс `-server`, но некоторые его не имеют. Как и в случае с `kotlin-spring` - это генератор сервера API, но суффикса нет (что как по мне вводит в заблуждение). Но мы должны помнить, что генерируем сервер API. 

2. Далее указываем где лежит схема и куда будет генерироваться код
```kotlin
inputSpec.set("$rootDir/src/main/resources/open-api/openapiexample.yaml")
outputDir.set("$buildDir/generated/api")
```

3. Далее настраиваем то, как нам будут сгенерированны классы.
```kotlin
configOptions.set( mapOf("<key>" to "<value>") )
```
Как здесь указать параметры читать здесь
https://openapi-generator.tech/docs/generators/kotlin-spring



## Код

Наследуемся от сгенериованного контроллера и реализуем методы. 

Пример см. в пакере `ru.golubtsov.controller.rest`


## Примечания
1. Кодогенерация делает свой мини-проект и тянет много зависимостей
2. Создается свой конфиг OpenApi для Spring 
3. Делает дефолтную реализацию в интерфейсах 
4. Делает имя классов по правилу: первое имя в пути + твой суффикс (по уполчанию API)
Например для группы путей
```html
/order/{id}
/order/number
/order/id
```
будут создан класс OrderApi.

Именно поэтому не стоит использовать пути вида
```html
/api/vi/order
```
5. По умолчанию на порту 8080, поэтому лучше его всегда прописывать явно в `configOptions`.
